<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Request a Quote | Bend Cut Send</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    .msg-success { color: #138a36; display: inline-block; margin-top: .25rem; }
    .msg-error { color: #c62828; display: inline-block; margin-top: .25rem; }
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1rem;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1rem;
    }
    .phone-row {
      display: grid;
      grid-template-columns: 0.35fr 1.65fr;
      gap: 0.5rem;
      max-width: 320px;
    }
    .phone-code {
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      border: 1px solid #cbd5e1;
      background: #f9fafb;
      font-size: 0.95rem;
      height: 2.4rem;
    }
    .phone-input {
      height: 2.4rem;
    }
    @media (max-width: 768px) {
      .grid-3,
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<nav class="navbar">
  <a href="index.html">Home</a>
  <a href="how-it-works.html">How it works</a>
  <a href="metals.html">Metals Available</a>
  <a href="qa.html">Q&amp;A</a>
  <a href="request-quote.html" class="active">Request a Quote</a>
  <a href="ask-question.html">Contact Us/Ask a Question</a>
</nav>

<main class="container">
  <h1>Request a Quote</h1>
  <p>Please complete the form below and we will email you a quote.</p>

  <form class="form-card" action="request-quote-handler.php" method="post" enctype="multipart/form-data">
    <div class="grid-2">
      <label>First Name
        <input type="text" name="first_name" required>
      </label>
      <label>Last Name
        <input type="text" name="last_name" required>
      </label>
    </div>
    <label>Email
      <input type="email" name="email" required>
    </label>
    <label>Mobile Number
      <div class="phone-row">
        <div class="phone-code">+27</div>
        <input
          class="phone-input"
          type="tel"
          name="phone"
          required
          pattern="^[0-9]{9}$"
          inputmode="numeric"
          placeholder="82 123 4567 (9 digits)">
      </div>
      <small>Enter the 9â€‘digit mobile number after +27 (no spaces or dashes in validation).</small>
    </label>

    <div class="grid-2">
      <label>Street Address
        <input type="text" name="street" placeholder="Street number and name" required>
      </label>
      <label>City
        <input type="text" name="city" required>
      </label>
    </div>
    <div class="grid-2">
      <label>Building Type
        <select name="building_type" required>
          <option value="">-- Select --</option>
          <option>House</option>
          <option>Apartment</option>
          <option>Office</option>
          <option>Industrial</option>
          <option>Other</option>
        </select>
      </label>
      <label>Postal Code
        <input type="text" name="postal_code" inputmode="numeric" pattern="\d{4}" title="4-digit postal code" placeholder="e.g., 2191" required>
      </label>
    </div>

    <div class="grid-3">
      <label>Material
        <select id="material" name="material" required>
          <option value="">-- Select material --</option>
          <option value="mild_steel">Mild Steel</option>
          <option value="3cr12">3CR12 Stainless Steel</option>
          <option value="430_ss">430 Stainless Steel</option>
          <option value="304_ss">304 Stainless Steel</option>
          <option value="316_ss">316 Stainless Steel</option>
          <option value="aluminium_1050">Aluminium 1050</option>
        </select>
      </label>

      <label>Surface Finish
        <select id="surface_finish" name="surface_finish" required disabled>
          <option value="">-- Select finish --</option>
        </select>
      </label>

      <label>Thickness
        <select id="thickness" name="thickness" required disabled>
          <option value="">-- Select thickness --</option>
        </select>
      </label>
    </div>

    <label>Quantity
      <input type="number" name="quantity" id="quantity" min="1" step="1" value="1" required inputmode="numeric">
    </label>

    <label>Comments
      <textarea name="comments" rows="5"></textarea>
    </label>

    <label>Design File
      <input id="design_file" type="file" name="design_file[]" multiple required
             accept=".dwg,.dwt,.dxf,.dws,.dwf,.dwfx,.dxb,.pdf,.stl,.jpeg,.jpg,.png,.tiff,.bmp"
             aria-describedby="design_file_help design_file_status">
      <small id="design_file_help">Please upload design files (dwg, dwt, dxf, dws, dwf, dwfx, dxb, pdf, stl, jpeg, jpg, png, tiff, bmp). Maximum size 25MB per file.</small>
      <small id="design_file_status" role="status" aria-live="polite"></small>
    </label>

    <button type="submit" class="cta-btn accent">Submit Request</button>
  </form>
</main>
<footer class="site-footer">
  <p>&copy; <span id="year"></span> Bend Cut Send.</p>
</footer>
<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // File validation script
  (function () {
    const input = document.getElementById('design_file');
    const status = document.getElementById('design_file_status');
    if (!input || !status) return;

    const allowed = ['dwg', 'dwt', 'dxf', 'dws', 'dwf', 'dwfx', 'dxb', 'pdf', 'stl', 'jpeg', 'jpg', 'png', 'tiff', 'bmp'];
    const MAX_BYTES = 25 * 1024 * 1024;

    input.addEventListener('change', function () {
      status.textContent = '';
      status.className = '';

      if (this.files.length > 5) {
        this.value = '';
        status.textContent = 'You can upload a maximum of 5 files.';
        status.className = 'msg-error';
        return;
      }

      for (let i = 0; i < this.files.length; i++) {
        const file = this.files[i];
        const name = (file.name || '').toLowerCase();
        const ext = name.includes('.') ? name.split('.').pop() : '';

        if (!allowed.includes(ext)) {
          this.value = '';
          status.textContent = 'File type not allowed. Allowed: ' + allowed.join(', ');
          status.className = 'msg-error';
          return;
        }

        if (file.size > MAX_BYTES) {
          this.value = '';
          status.textContent = 'File "' + file.name + '" is too large. Maximum size: 25MB.';
          status.className = 'msg-error';
          return;
        }
      }

      status.textContent = 'Uploads look good. Files will be sent with your request.';
      status.className = 'msg-success';
    });
  })();

  // Material finish and thickness dropdown handlers
  (function () {
    const materialSelect = document.getElementById('material');
    const finishSelect = document.getElementById('surface_finish');
    const thicknessSelect = document.getElementById('thickness');
    
    const data = {
        mild_steel: {
            finishes: {
                cold_rolled: { thicknesses: ['0.8', '1.0', '1.2'] },
                hot_rolled: { thicknesses: ['1.6', '2.0', '3.0', '4.0'] },
            },
        },
        '3cr12': {
            finishes: {
                '2d': { thicknesses: ['1.0', '1.5'] },
                'no1': { thicknesses: ['3.0', '4.5'] },
            },
        },
    };

    // Reset dropdown
    function resetSelect(select, placeholder) {
        select.innerHTML = '';
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = placeholder;
        select.appendChild(opt);
        select.value = '';
    }

    materialSelect.addEventListener('change', function () {
        const materialKey = this.value;
        resetSelect(finishSelect, '-- Select finish --');
        resetSelect(thicknessSelect, '-- Select thickness --');
        finishSelect.disabled = true;
        thicknessSelect.disabled = true;

        if (!materialKey || !data[materialKey]) return;

        const finishes = data[materialKey].finishes;
        for (const key in finishes) {
            const opt = document.createElement('option');
            opt.value = key;
            opt.textContent = key;
            finishSelect.appendChild(opt);
        }

        finishSelect.disabled = false;
    });

    finishSelect.addEventListener('change', function () {
        const materialKey = materialSelect.value;
        const finishKey = this.value;
        resetSelect(thicknessSelect, '-- Select thickness --');
        thicknessSelect.disabled = true;

        if (!finishKey || !data[materialKey]?.finishes[finishKey]) return;

        const thicknesses = data[materialKey].finishes[finishKey].thicknesses;
        for (const t of thicknesses) {
            const opt = document.createElement('option');
            opt.value = t;
            opt.textContent = `${t} mm`;
            thicknessSelect.appendChild(opt);
        }

        thicknessSelect.disabled = false;
    });
  })();
</script>
</body>
</html>